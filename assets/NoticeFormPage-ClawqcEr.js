import{d as T,r as m,B as z,a as A,o as P,G as L,c as a,y as C,b as n,e as c,t as u,w as G,F as g,f as x,z as K,A as Q,X,Y,Q as q,i as k,v as H,j as J,n as I,R as O,p as W,h as l,u as Z,$ as ee}from"./index-CpL_cJAr.js";import{_ as te}from"./PageHeader.vue_vue_type_script_setup_true_lang-B9ZSwk3v.js";const se={class:"font-[var(--font-body)]"},oe={class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},ae={class:"text-3xl font-bold text-center mb-8 text-[var(--dream-text)]"},le={key:0},ne=["for"],ie=["type","id","onUpdate:modelValue"],re=["id","onUpdate:modelValue"],ce={key:1},de={class:"block text-sm font-medium text-gray-700 mb-1"},ue=["id"],me={key:0,class:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},pe=["src"],ge=["onClick"],ve={key:1,class:"mt-4 pt-4 border-t"},_e={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},fe=["onClick"],xe=["src","alt"],be={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-md"},he={key:2},ye={class:"block text-sm font-medium text-gray-700 mb-1"},ke=["id"],we={key:0,class:"mt-4 list-disc list-inside text-sm space-y-1"},De=["onClick"],Fe={key:1,class:"mt-4 pt-4 border-t"},Ce={class:"text-sm space-y-1"},Ie=["onClick"],Ne={key:0,class:"text-xs font-bold"},Se={key:3,class:"flex items-center"},Ee=["id","onUpdate:modelValue"],Ve=["for"],Ue={class:"pt-5"},$e={class:"flex justify-end space-x-3"},je={type:"submit",class:"btn-base bg-[var(--dream-main)] hover:bg-opacity-80 text-white"},ze=T({__name:"NoticeFormPage",setup(Me){const w=L(),D=q(),F=m(Z.isStaff),b=m(null),v=z(()=>b.value!==null),r=A({...{title:"",contents:"",is_important:!1}}),N=m(ee),h=m([]),y=m([]),_=m([]),p=m([]),f=m([]),S=i=>{const t=X.find(s=>s.pk===i)||Y.find(s=>s.pk===i);t?(r.title=t.title,r.contents=t.contents||"",r.is_important=t.is_important||!1,_.value=(t.images||[]).map(s=>({...s,toDelete:!1})),f.value=(t.files||[]).map(s=>({...s,toDelete:!1}))):(console.error("Notice not found for editing"),D.push("/notice"))};P(()=>{w.params.pk&&(b.value=parseInt(w.params.pk,10),S(b.value))});const E=i=>{const t=i.target;t.files&&(Array.from(t.files).forEach(s=>{h.value.push(s);const e=new FileReader;e.onload=o=>{var d;y.value.push({file:s,url:(d=o.target)==null?void 0:d.result})},e.readAsDataURL(s)}),t.value="")},V=i=>{h.value.splice(i,1),y.value.splice(i,1)},U=i=>{const t=_.value.find(s=>s.id===i);t&&(t.toDelete=!t.toDelete)},$=i=>{const t=i.target;t.files&&(p.value.push(...Array.from(t.files)),t.value="")},j=i=>{p.value.splice(i,1)},M=i=>{const t=f.value.find(s=>s.id===i);t&&(t.toDelete=!t.toDelete)},B=()=>{const i=_.value.filter(e=>e.toDelete).map(e=>e.id),t=f.value.filter(e=>e.toDelete).map(e=>e.id),s=new FormData;s.append("title",r.title),s.append("contents",r.contents),s.append("is_important",String(r.is_important)),h.value.forEach(e=>s.append("new_images",e)),p.value.forEach(e=>s.append("new_files",e)),i.forEach(e=>s.append("delete_images",String(e))),t.forEach(e=>s.append("delete_files",String(e))),console.log("Form Data to Submit:",{...r,newImages:h.value.map(e=>e.name),newFiles:p.value.map(e=>e.name),deleteImageIds:i,deleteFileIds:t}),v.value?(console.log(`Updating notice with ID: ${b.value}`),alert("공지사항이 수정되었습니다.")):(console.log("Creating new notice"),alert("공지사항이 등록되었습니다.")),D.push("/notice")};return(i,t)=>{const s=Q("router-link");return l(),a("div",se,[C(te,{title:"소통 마당",backgroundImageUrl:"/Dreamseekers-FE/img/top_header/forum.jpg"}),n("div",oe,[n("h1",ae,u(v.value?"공지사항 수정":"공지사항 작성"),1),F.value?(l(),a("form",{key:0,onSubmit:G(B,["prevent"]),class:"max-w-3xl mx-auto space-y-6"},[(l(!0),a(g,null,x(N.value,e=>(l(),a(g,{key:e.id},[e.type==="text"||e.type==="textarea"?(l(),a("div",le,[n("label",{for:e.id,class:"block text-sm font-medium text-gray-700 mb-1"},u(e.label),9,ne),e.type==="text"?k((l(),a("input",{key:0,type:e.type,id:e.id,"onUpdate:modelValue":o=>r[e.name]=o,class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[var(--dream-main)] focus:border-[var(--dream-main)] sm:text-sm"},null,8,ie)),[[H,r[e.name]]]):e.type==="textarea"?k((l(),a("textarea",{key:1,id:e.id,"onUpdate:modelValue":o=>r[e.name]=o,rows:"10",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[var(--dream-main)] focus:border-[var(--dream-main)] sm:text-sm resize-none"},null,8,re)),[[J,r[e.name]]]):c("",!0)])):c("",!0),e.type==="image"?(l(),a("div",ce,[n("label",de,u(e.label),1),n("input",{type:"file",id:e.id,multiple:"",accept:"image/*",onChange:E,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--dream-blue)] file:text-white hover:file:bg-opacity-80 cursor-pointer"},null,40,ue),y.value.length>0?(l(),a("div",me,[(l(!0),a(g,null,x(y.value,(o,d)=>(l(),a("div",{key:`new-img-${d}`,class:"relative"},[n("img",{src:o.url,alt:"New image preview",class:"w-full h-32 object-cover rounded-md shadow"},null,8,pe),n("button",{onClick:R=>V(d),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs leading-none"},"×",8,ge)]))),128))])):c("",!0),v.value&&_.value.length>0?(l(),a("div",ve,[t[1]||(t[1]=n("p",{class:"text-xs text-gray-600 mb-2"},"기존 이미지 (클릭하여 삭제 표시/해제)",-1)),n("div",_e,[(l(!0),a(g,null,x(_.value,o=>(l(),a("div",{key:o.id,class:"relative cursor-pointer",onClick:d=>U(o.id)},[n("img",{src:o.url,alt:o.alt||"Existing image",class:I(["w-full h-32 object-cover rounded-md shadow",{"opacity-50 ring-2 ring-red-500":o.toDelete}])},null,10,xe),o.toDelete?(l(),a("div",be,t[0]||(t[0]=[n("span",{class:"text-white text-xs font-bold"},"삭제 예정",-1)]))):c("",!0)],8,fe))),128))])])):c("",!0)])):c("",!0),e.type==="file"?(l(),a("div",he,[n("label",ye,u(e.label),1),n("input",{type:"file",id:e.id,multiple:"",onChange:$,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--dream-blue)] file:text-white hover:file:bg-opacity-80 cursor-pointer"},null,40,ke),p.value.length>0?(l(),a("ul",we,[(l(!0),a(g,null,x(p.value,(o,d)=>(l(),a("li",{key:`new-file-${d}`,class:"flex justify-between items-center"},[n("span",null,u(o.name)+" ("+u((o.size/1024).toFixed(1))+" KB)",1),n("button",{onClick:R=>j(d),type:"button",class:"text-red-500 hover:text-red-700 text-xs"},"× 제거",8,De)]))),128))])):c("",!0),v.value&&f.value.length>0?(l(),a("div",Fe,[t[2]||(t[2]=n("p",{class:"text-xs text-gray-600 mb-2"},"기존 파일 (클릭하여 삭제 표시/해제)",-1)),n("ul",Ce,[(l(!0),a(g,null,x(f.value,o=>(l(),a("li",{key:o.id,onClick:d=>M(o.id),class:I(["flex justify-between items-center cursor-pointer p-1 rounded hover:bg-gray-100",{"line-through text-red-500 bg-red-50":o.toDelete}])},[n("span",null,u(o.name),1),o.toDelete?(l(),a("span",Ne,"(삭제 예정)")):c("",!0)],10,Ie))),128))])])):c("",!0)])):c("",!0),e.type==="checkbox"&&F.value?(l(),a("div",Se,[k(n("input",{id:e.id,type:"checkbox","onUpdate:modelValue":o=>r[e.name]=o,class:"h-4 w-4 text-[var(--dream-main)] border-gray-300 rounded focus:ring-[var(--dream-main)]"},null,8,Ee),[[O,r[e.name]]]),n("label",{for:e.id,class:"ml-2 block text-sm text-gray-900"},u(e.label),9,Ve)])):c("",!0)],64))),128)),n("div",Ue,[n("div",$e,[C(s,{to:"/notice",class:"btn-base bg-gray-200 hover:bg-gray-300 text-gray-700"},{default:K(()=>t[3]||(t[3]=[W(" 취소 ")])),_:1,__:[3]}),n("button",je,u(v.value?"수정 완료":"등록"),1)])])],32)):c("",!0)])])}}});export{ze as default};

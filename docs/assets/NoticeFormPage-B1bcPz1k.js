import{d as R,r as m,B as T,a as z,o as A,G as P,c as l,y as F,b as a,t as u,w as L,F as g,f as b,z as G,A as K,X as Q,Y as X,Q as Y,e as c,i as k,v as q,j as H,n as C,R as J,p as O,h as n,u as W,$ as Z}from"./index-CykwwcsO.js";import{_ as ee}from"./PageHeader.vue_vue_type_script_setup_true_lang-DIMsOurW.js";const te={class:"font-[var(--font-body)]"},se={class:"container mx-auto px-4 sm:px-6 lg:px-8 py-12"},oe={class:"text-3xl font-bold text-center mb-8 text-[var(--dream-text)]"},ae={key:0},le=["for"],ne=["type","id","onUpdate:modelValue"],ie=["id","onUpdate:modelValue"],re={key:1},ce={class:"block text-sm font-medium text-gray-700 mb-1"},de=["id"],ue={key:0,class:"mt-4 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},me=["src"],pe=["onClick"],ge={key:1,class:"mt-4 pt-4 border-t"},ve={class:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"},_e=["onClick"],fe=["src","alt"],be={key:0,class:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-md"},xe={key:2},he={class:"block text-sm font-medium text-gray-700 mb-1"},ye=["id"],ke={key:0,class:"mt-4 list-disc list-inside text-sm space-y-1"},we=["onClick"],De={key:1,class:"mt-4 pt-4 border-t"},Fe={class:"text-sm space-y-1"},Ce=["onClick"],Ie={key:0,class:"text-xs font-bold"},Ne={key:3,class:"flex items-center"},Se=["id","onUpdate:modelValue"],Ee=["for"],Ve={class:"pt-5"},Ue={class:"flex justify-end space-x-3"},$e={type:"submit",class:"btn-base bg-[var(--dream-main)] hover:bg-opacity-80 text-white"},Te=R({__name:"NoticeFormPage",setup(je){const w=P(),D=Y(),I=m(W.isStaff);m(Z);const x=m(null),v=T(()=>x.value!==null),r=z({...{title:"",contents:"",is_important:!1}}),h=m([]),y=m([]),_=m([]),p=m([]),f=m([]),N=i=>{const t=Q.find(s=>s.pk===i)||X.find(s=>s.pk===i);t?(r.title=t.title,r.contents=t.contents||"",r.is_important=t.is_important||!1,_.value=(t.images||[]).map(s=>({...s,toDelete:!1})),f.value=(t.files||[]).map(s=>({...s,toDelete:!1}))):(console.error("Notice not found for editing"),D.push("/notice"))};A(()=>{w.params.pk&&(x.value=parseInt(w.params.pk,10),N(x.value))});const S=i=>{const t=i.target;t.files&&(Array.from(t.files).forEach(s=>{h.value.push(s);const e=new FileReader;e.onload=o=>{var d;y.value.push({file:s,url:(d=o.target)==null?void 0:d.result})},e.readAsDataURL(s)}),t.value="")},E=i=>{h.value.splice(i,1),y.value.splice(i,1)},V=i=>{const t=_.value.find(s=>s.id===i);t&&(t.toDelete=!t.toDelete)},U=i=>{const t=i.target;t.files&&(p.value.push(...Array.from(t.files)),t.value="")},$=i=>{p.value.splice(i,1)},j=i=>{const t=f.value.find(s=>s.id===i);t&&(t.toDelete=!t.toDelete)},M=()=>{const i=_.value.filter(e=>e.toDelete).map(e=>e.id),t=f.value.filter(e=>e.toDelete).map(e=>e.id),s=new FormData;s.append("title",r.title),s.append("contents",r.contents),s.append("is_important",String(r.is_important)),h.value.forEach(e=>s.append("new_images",e)),p.value.forEach(e=>s.append("new_files",e)),i.forEach(e=>s.append("delete_images",String(e))),t.forEach(e=>s.append("delete_files",String(e))),console.log("Form Data to Submit:",{...r,newImages:h.value.map(e=>e.name),newFiles:p.value.map(e=>e.name),deleteImageIds:i,deleteFileIds:t}),v.value?(console.log(`Updating notice with ID: ${x.value}`),alert("공지사항이 수정되었습니다.")):(console.log("Creating new notice"),alert("공지사항이 등록되었습니다.")),D.push("/notice")};return(i,t)=>{const s=K("router-link");return n(),l("div",te,[F(ee,{title:"소통 마당",backgroundImageUrl:"/img/top_header/forum.jpg"}),a("div",se,[a("h1",oe,u(v.value?"공지사항 수정":"공지사항 작성"),1),a("form",{onSubmit:L(M,["prevent"]),class:"max-w-3xl mx-auto space-y-6"},[(n(!0),l(g,null,b(i.formSchema,e=>(n(),l(g,{key:e.id},[e.type==="text"||e.type==="textarea"?(n(),l("div",ae,[a("label",{for:e.id,class:"block text-sm font-medium text-gray-700 mb-1"},u(e.label),9,le),e.type==="text"?k((n(),l("input",{key:0,type:e.type,id:e.id,"onUpdate:modelValue":o=>r[e.name]=o,class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[var(--dream-main)] focus:border-[var(--dream-main)] sm:text-sm"},null,8,ne)),[[q,r[e.name]]]):e.type==="textarea"?k((n(),l("textarea",{key:1,id:e.id,"onUpdate:modelValue":o=>r[e.name]=o,rows:"10",class:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[var(--dream-main)] focus:border-[var(--dream-main)] sm:text-sm resize-none"},null,8,ie)),[[H,r[e.name]]]):c("",!0)])):c("",!0),e.type==="image"?(n(),l("div",re,[a("label",ce,u(e.label),1),a("input",{type:"file",id:e.id,multiple:"",accept:"image/*",onChange:S,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--dream-blue)] file:text-white hover:file:bg-opacity-80 cursor-pointer"},null,40,de),y.value.length>0?(n(),l("div",ue,[(n(!0),l(g,null,b(y.value,(o,d)=>(n(),l("div",{key:`new-img-${d}`,class:"relative"},[a("img",{src:o.url,alt:"New image preview",class:"w-full h-32 object-cover rounded-md shadow"},null,8,me),a("button",{onClick:B=>E(d),type:"button",class:"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 text-xs leading-none"},"×",8,pe)]))),128))])):c("",!0),v.value&&_.value.length>0?(n(),l("div",ge,[t[1]||(t[1]=a("p",{class:"text-xs text-gray-600 mb-2"},"기존 이미지 (클릭하여 삭제 표시/해제)",-1)),a("div",ve,[(n(!0),l(g,null,b(_.value,o=>(n(),l("div",{key:o.id,class:"relative cursor-pointer",onClick:d=>V(o.id)},[a("img",{src:o.url,alt:o.alt||"Existing image",class:C(["w-full h-32 object-cover rounded-md shadow",{"opacity-50 ring-2 ring-red-500":o.toDelete}])},null,10,fe),o.toDelete?(n(),l("div",be,t[0]||(t[0]=[a("span",{class:"text-white text-xs font-bold"},"삭제 예정",-1)]))):c("",!0)],8,_e))),128))])])):c("",!0)])):c("",!0),e.type==="file"?(n(),l("div",xe,[a("label",he,u(e.label),1),a("input",{type:"file",id:e.id,multiple:"",onChange:U,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-[var(--dream-blue)] file:text-white hover:file:bg-opacity-80 cursor-pointer"},null,40,ye),p.value.length>0?(n(),l("ul",ke,[(n(!0),l(g,null,b(p.value,(o,d)=>(n(),l("li",{key:`new-file-${d}`,class:"flex justify-between items-center"},[a("span",null,u(o.name)+" ("+u((o.size/1024).toFixed(1))+" KB)",1),a("button",{onClick:B=>$(d),type:"button",class:"text-red-500 hover:text-red-700 text-xs"},"× 제거",8,we)]))),128))])):c("",!0),v.value&&f.value.length>0?(n(),l("div",De,[t[2]||(t[2]=a("p",{class:"text-xs text-gray-600 mb-2"},"기존 파일 (클릭하여 삭제 표시/해제)",-1)),a("ul",Fe,[(n(!0),l(g,null,b(f.value,o=>(n(),l("li",{key:o.id,onClick:d=>j(o.id),class:C(["flex justify-between items-center cursor-pointer p-1 rounded hover:bg-gray-100",{"line-through text-red-500 bg-red-50":o.toDelete}])},[a("span",null,u(o.name),1),o.toDelete?(n(),l("span",Ie,"(삭제 예정)")):c("",!0)],10,Ce))),128))])])):c("",!0)])):c("",!0),e.type==="checkbox"&&I.value?(n(),l("div",Ne,[k(a("input",{id:e.id,type:"checkbox","onUpdate:modelValue":o=>r[e.name]=o,class:"h-4 w-4 text-[var(--dream-main)] border-gray-300 rounded focus:ring-[var(--dream-main)]"},null,8,Se),[[J,r[e.name]]]),a("label",{for:e.id,class:"ml-2 block text-sm text-gray-900"},u(e.label),9,Ee)])):c("",!0)],64))),128)),a("div",Ve,[a("div",Ue,[F(s,{to:"/notice",class:"btn-base bg-gray-200 hover:bg-gray-300 text-gray-700"},{default:G(()=>t[3]||(t[3]=[O(" 취소 ")])),_:1,__:[3]}),a("button",$e,u(v.value?"수정 완료":"등록"),1)])])],32)])])}}});export{Te as default};
